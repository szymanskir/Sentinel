matrix:
  include:
    - language: python
      env: COMMAND=sentinel_connectors
      sudo: required
      dist: xenial
      python: "3.6.7"
      cache:
        pip: true
      before_install:
        - git diff --name-only $TRAVIS_COMMIT_RANGE | grep -qE '^(sentinel_connectors/|sentinel_common/|\.travis.yml)' || exit 0
        - cd sentinel_connectors
      install:
        - make requirements
      script:
        - make tests
        - make lint

    - language: python
      env: COMMAND=sentinel_backend
      sudo: required
      dist: xenial
      python: "3.6.7"
      cache:
        pip: true
      before_install:
        - git diff --name-only $TRAVIS_COMMIT_RANGE | grep -qE '^(sentinel_backend/|sentinel_common/|\.travis.yml)' || exit 0
        - cd sentinel_backend
      install:
        - make venv
      script:
        - make lint

      before_deploy:
        - cd ..
        - zip sentinel-backend.zip beanstalk/backend/Dockerrun.aws.json

      deploy:
        provider: elasticbeanstalk
        region: "eu-central-1"
        app: "sentinel-backend"
        env: "SentinelBackend-env"
        zip_file: sentinel-backend.zip
        bucket_name: "elasticbeanstalk-eu-central-1-848201210986"
        bucket_path: "sentinel-backend"

        on:
          branch: improvement/dockerize-backend
        skip_cleanup: true

    - language: node_js
      env: COMMAND=sentinel_web
      node_js:
        - 12.2
      before_install:
        - git diff --name-only $TRAVIS_COMMIT_RANGE | grep -qE '^(sentinel_web/|sentinel_common/|\.travis.yml)' || exit 0
        - cd sentinel_web
      install:
        - yarn install
      script:
        - yarn build
